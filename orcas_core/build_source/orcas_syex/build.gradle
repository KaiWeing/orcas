project.ext.project_dir        = "../orcas"
project.ext.mwe2_file_name     = "src/de/opitzconsulting/GenerateOrcasDsl.mwe2"
project.ext.postfix            = "syex"
project.ext.xtext_project_name = "orcas"

apply from: '../xtext_generator_build_with_plsql_plugin.gradle'

dependencies 
{
   project(':orcas_xtext_extension.generator')
}

task(generateObjectTypes, dependsOn: createSqlplusDir, type: JavaExec) 
{
  classpath configurations.generatorRunPath

  main = "de.opitzconsulting.orcas.ot.OracleOtGenerator"
  args "${buildDir}/sqlplus/sql/replaceables/types/ot_${project.ext.postfix}.sql"
  args project.ext.postfix

  outputs.file args[0]
}

task(copyGeneratedXtextFileToOriginalFilesToBuild, dependsOn: copyOriginalFilesToBuild, type: Copy)
{
  from "${project(':orcas_xtext_extension.generator').buildDir}/xtext_syex"
  into "${project.ext.copy_original_folder}/src"
}


copyGeneratedXtextFileToOriginalFilesToBuild.dependsOn copyOriginalFilesToBuild
copyGeneratedXtextFileToOriginalFilesToBuild.dependsOn ':orcas_xtext_extension.generator:build'

generateXtext.dependsOn copyGeneratedXtextFileToOriginalFilesToBuild

jar.dependsOn generateObjectTypes

jar {
  from "${buildDir}/sqlplus"
}

